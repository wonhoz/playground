# Screen.Recorder 신규 앱 개발

> 작업일시: 2026-02-20 16:03 ~ 16:17 KST
> 작업자: Claude Opus 4.6

---

## 작업 요약

화면 특정 영역을 MP4(동영상) 및 GIF(이미지) 포맷으로 녹화하는 WPF 앱을 신규 개발하였습니다.

---

## Phase 1: 프로젝트 생성 및 솔루션 등록 (`d34489d`)

- `Tools/Screen.Recorder/` 폴더에 WPF 프로젝트 생성
- .NET 10.0-windows / C# / WPF + WinForms 혼합 (System.Drawing 사용)
- `Playground.sln` 및 `Playground.slnx` 양쪽 등록
- `+publish-all.cmd`에 `call :pub "Screen.Recorder"` 항목 추가

## Phase 2: 앱 아이콘 생성 (`0195626`)

- 녹화 버튼 컨셉 (빨간 원 + 흰 테두리 + 빨간 REC 점)
- 멀티 사이즈 ICO (16/32/48/256px)
- `Resources/app.ico`

## Phase 3: 다크 테마 UI + 영역 선택 오버레이 (`8aa06e8`)

### MainWindow (메인 UI)
- 다크 테마: `#1A1A2E` 배경, `#E74C3C` 빨간 악센트
- `DwmSetWindowAttribute` 다크 타이틀바
- 녹화 영역 정보 패널 (좌표, 크기 표시)
- 출력 형식 선택: MP4 / GIF
- FPS 선택: 10 / 15 / 24 / 30
- 저장 폴더 선택 (OpenFolderDialog)
- 상태 바: 상태 표시등 (색상 변화) + 타이머
- 버튼: 녹화 시작 / 일시정지 / 중지

### RegionSelectWindow (영역 선택 오버레이)
- 전체 가상 스크린 덮기 (다중 모니터 지원)
- 반투명 검정 오버레이 + 드래그 영역 선택
- 빨간 테두리 + 크기 표시 (`가로 × 세로`)
- ESC로 취소, 드래그 완료로 확정
- 짝수 해상도 자동 보정 (인코더 호환)

## Phase 4: 화면 캡처 엔진 (`8aa06e8`)

- `ScreenCaptureService`: `Graphics.CopyFromScreen()` 기반
- 지정 영역을 FPS에 맞춰 프레임 단위 캡처
- PNG 시퀀스로 임시 폴더에 저장
- 일시정지/재개 지원
- 녹화 완료 시 임시 파일 자동 정리

## Phase 5-6: MP4 + GIF 인코딩 (`0918d48`)

### MP4 인코딩 (FFmpeg CLI)
- FFmpeg 자동 탐색 (PATH, 일반 설치 경로, Chocolatey, Scoop)
- H.264, yuv420p, CRF 23, preset fast
- `+faststart` 플래그 (스트리밍 최적화)
- FFmpeg 미설치 시 설치 안내 메시지

### GIF 인코딩 (이중 전략)
- **FFmpeg 있을 때**: 2-pass 팔레트 최적화 (고품질 GIF)
- **FFmpeg 없을 때**: System.Drawing 네이티브 인코딩 (fallback)
  - 8-bit 색상 양자화 (332 팔레트)
  - GIF89a 바이너리 직접 조립
  - NETSCAPE2.0 무한 루프 확장

## Phase 7: 빌드 검증

- 전체 솔루션 (9개 프로젝트) 빌드 성공
- .sln 및 .slnx 양쪽 모두 빌드 확인
- **경고 0개, 오류 0개**

---

## 프로젝트 구조

```
Tools/Screen.Recorder/
├── Models/
│   └── RecordingSettings.cs      # 녹화 설정 (FPS, 형식, 출력 폴더)
├── Services/
│   ├── ScreenCaptureService.cs   # 화면 캡처 엔진
│   └── EncoderService.cs         # MP4/GIF 인코딩
├── Resources/
│   └── app.ico                   # 앱 아이콘
├── App.xaml / App.xaml.cs
├── MainWindow.xaml / .xaml.cs     # 메인 UI
├── RegionSelectWindow.xaml / .cs  # 영역 선택 오버레이
└── Screen.Recorder.csproj
```

---

## 기술 스택

| 항목 | 기술 |
|------|------|
| UI | WPF (.NET 10.0-windows) |
| 화면 캡처 | `Graphics.CopyFromScreen()` (GDI+) |
| MP4 인코딩 | FFmpeg CLI (외부 의존) |
| GIF 인코딩 | FFmpeg 2-pass / System.Drawing 네이티브 fallback |
| 아이콘 | System.Drawing으로 생성 (16/32/48/256px ICO) |
