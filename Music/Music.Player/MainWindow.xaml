<Window x:Class="Music.Player.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Music Player"
        Icon="pack://application:,,,/Resources/app.ico"
        Height="420" Width="380"
        MinHeight="380" MinWidth="320"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.Resources>
        <!-- Dark Theme Colors -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1E1E1E"/>
        <SolidColorBrush x:Key="CardBrush" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="CardLightBrush" Color="#383838"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#404040"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#FF6B35"/>
        <SolidColorBrush x:Key="AccentHoverBrush" Color="#FF8555"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#EEEEEE"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#9E9E9E"/>

        <!-- Title Bar Button Style -->
        <Style x:Key="TitleBarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#9E9E9E"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#383838"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E81123"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Control Button Style -->
        <Style x:Key="ControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="20">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#404040"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Play Button Style (larger) -->
        <Style x:Key="PlayButtonStyle" TargetType="Button" BasedOn="{StaticResource ControlButtonStyle}">
            <Setter Property="Width" Value="56"/>
            <Setter Property="Height" Value="56"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{StaticResource AccentBrush}" CornerRadius="28">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentHoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle Button Style -->
        <Style x:Key="ToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="18">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#383838"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Slider Style -->
        <Style x:Key="SliderStyle" TargetType="Slider">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Border x:Name="TrackBackground" Height="4" Background="#404040" CornerRadius="2"/>
                            <Canvas>
                                <Border x:Name="PART_SelectionRange" Height="4" Background="{StaticResource AccentBrush}" CornerRadius="2"
                                        Width="{Binding ActualWidth, ElementName=TrackBackground, Converter={x:Null}}"/>
                            </Canvas>
                            <Track x:Name="PART_Track">
                                <Track.Thumb>
                                    <Thumb Width="14" Height="14" Cursor="Hand">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Ellipse Fill="{StaticResource AccentBrush}"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListBox Style -->
        <Style x:Key="PlaylistItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="AllowDrop" Value="True"/>
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="PlaylistItem_PreviewMouseLeftButtonDown"/>
            <EventSetter Event="PreviewMouseMove" Handler="PlaylistItem_PreviewMouseMove"/>
            <EventSetter Event="Drop" Handler="PlaylistItem_Drop"/>
            <EventSetter Event="DragOver" Handler="PlaylistItem_DragOver"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}" CornerRadius="4" Margin="2,1">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#383838"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#404040"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Dark ScrollBar Thumb -->
        <Style x:Key="ScrollBarThumbStyle" TargetType="Thumb">
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="IsTabStop" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border x:Name="ThumbBorder" Background="#505050" CornerRadius="4" Margin="2"/>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ThumbBorder" Property="Background" Value="#606060"/>
                            </Trigger>
                            <Trigger Property="IsDragging" Value="True">
                                <Setter TargetName="ThumbBorder" Property="Background" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Dark Vertical ScrollBar -->
        <Style x:Key="DarkScrollBarStyle" TargetType="ScrollBar">
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Width" Value="10"/>
            <Setter Property="MinWidth" Value="10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="Transparent">
                            <Border Background="#2A2A2A" CornerRadius="5" Margin="1"/>
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource ScrollBarThumbStyle}"/>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Dark ScrollViewer Style -->
        <Style x:Key="DarkScrollViewerStyle" TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ScrollContentPresenter Grid.Column="0"/>
                            <ScrollBar x:Name="PART_VerticalScrollBar" Grid.Column="1"
                                       Style="{StaticResource DarkScrollBarStyle}"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Dark ListBox Style -->
        <Style x:Key="DarkListBoxStyle" TargetType="ListBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBox">
                        <ScrollViewer Style="{StaticResource DarkScrollViewerStyle}"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="{TemplateBinding Padding}">
                            <ItemsPresenter/>
                        </ScrollViewer>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Background="#1E1E1E" CornerRadius="8" BorderBrush="#404040" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="28"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Grid Grid.Row="0" Background="#252525" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
                    <TextBlock Text="Music Player" Foreground="#9E9E9E" FontSize="11" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Style="{StaticResource TitleBarButtonStyle}" Click="MinimizeButton_Click">
                        <Path Fill="#9E9E9E" Data="M0,5 L10,5" Stroke="#9E9E9E" StrokeThickness="1"/>
                    </Button>
                    <Button Style="{StaticResource CloseButtonStyle}" Click="CloseButton_Click">
                        <Path Stroke="#9E9E9E" StrokeThickness="1" Data="M0,0 L10,10 M10,0 L0,10"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Main Content -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition x:Name="PlaylistColumn" Width="0"/>
                </Grid.ColumnDefinitions>

                <!-- Player Panel -->
                <Grid Grid.Column="0" Margin="16" Background="Transparent" MouseLeftButtonDown="ContentArea_MouseLeftButtonDown">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Album Art -->
                    <Border Grid.Row="0" Background="#2D2D2D" CornerRadius="8" Margin="20,10,20,10"
                            ClipToBounds="True">
                        <Grid>
                            <!-- Default Music Icon -->
                            <Viewbox x:Name="DefaultIcon" Width="80" Height="80">
                                <Canvas Width="24" Height="24">
                                    <Path Fill="#505050" Data="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                                </Canvas>
                            </Viewbox>
                            <!-- Album Art Image -->
                            <Image x:Name="AlbumArtImage" Stretch="Uniform" Visibility="Collapsed"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            <!-- Lyrics Overlay Panel -->
                            <Border x:Name="LyricsPanel" Visibility="Collapsed" Background="#E81E1E1E">
                                <Grid>
                                    <TextBlock x:Name="LyricsNoFileText"
                                               Text="가사 파일(.lrc)을 찾을 수 없습니다"
                                               Foreground="#505050" FontSize="12"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Visibility="Collapsed"/>
                                    <ListBox x:Name="LyricsBox"
                                             Background="Transparent" BorderThickness="0"
                                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                             Focusable="False" Padding="0,8">
                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                                <Setter Property="Padding" Value="12,3"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ListBoxItem">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ListBox.ItemContainerStyle>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Text}" TextAlignment="Center"
                                                           TextWrapping="Wrap" MaxWidth="260">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="#555555"/>
                                                            <Setter Property="FontSize" Value="12"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                                    <Setter Property="Foreground" Value="#FF6B35"/>
                                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                                    <Setter Property="FontSize" Value="13"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Track Info -->
                    <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,0,0,8">
                        <TextBlock x:Name="TitleText" Text="No track selected" FontSize="16" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"
                                   TextTrimming="CharacterEllipsis" MaxWidth="300"/>
                        <TextBlock x:Name="ArtistText" Text="" FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"
                                   TextTrimming="CharacterEllipsis" MaxWidth="300" Margin="0,2,0,0"/>
                    </StackPanel>

                    <!-- Progress Bar -->
                    <Grid Grid.Row="2" Margin="0,8,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="40"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="CurrentTimeText" Text="0:00" FontSize="11"
                                   Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                        <Slider x:Name="ProgressSlider" Grid.Column="1" Style="{StaticResource SliderStyle}"
                                Minimum="0" Maximum="100" Value="0" VerticalAlignment="Center" Margin="8,0"
                                PreviewMouseLeftButtonDown="ProgressSlider_PreviewMouseLeftButtonDown"
                                PreviewMouseLeftButtonUp="ProgressSlider_PreviewMouseLeftButtonUp"
                                MouseDoubleClick="ProgressSlider_MouseDoubleClick"
                                ValueChanged="ProgressSlider_ValueChanged"/>
                        <TextBlock x:Name="TotalTimeText" Grid.Column="2" Text="0:00" FontSize="11"
                                   Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"
                                   HorizontalAlignment="Right"/>
                    </Grid>

                    <!-- Controls -->
                    <Grid Grid.Row="3" Margin="0,8,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Controls (Shuffle) -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,16,0">
                            <ToggleButton x:Name="ShuffleButton" Style="{StaticResource ToggleButtonStyle}"
                                          ToolTip="Shuffle" Click="ShuffleButton_Click">
                                <Viewbox Width="18" Height="18">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"
                                              Data="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
                                    </Canvas>
                                </Viewbox>
                            </ToggleButton>
                        </StackPanel>

                        <!-- Center Controls -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button x:Name="PreviousButton" Style="{StaticResource ControlButtonStyle}"
                                    Click="PreviousButton_Click" ToolTip="Previous">
                                <Viewbox Width="20" Height="20">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="{StaticResource TextPrimaryBrush}"
                                              Data="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                                    </Canvas>
                                </Viewbox>
                            </Button>
                            <Button x:Name="PlayPauseButton" Style="{StaticResource PlayButtonStyle}"
                                    Click="PlayPauseButton_Click" Margin="8,0" ToolTip="Play/Pause">
                                <Viewbox x:Name="PlayIcon" Width="24" Height="24">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="#1E1E1E" Data="M8 5v14l11-7z"/>
                                    </Canvas>
                                </Viewbox>
                            </Button>
                            <Button x:Name="NextButton" Style="{StaticResource ControlButtonStyle}"
                                    Click="NextButton_Click" ToolTip="Next">
                                <Viewbox Width="20" Height="20">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="{StaticResource TextPrimaryBrush}"
                                              Data="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                                    </Canvas>
                                </Viewbox>
                            </Button>
                        </StackPanel>

                        <!-- Right Controls (Repeat, Playlist, Lyrics) -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Left" Margin="8,0,0,0">
                            <ToggleButton x:Name="RepeatButton" Style="{StaticResource ToggleButtonStyle}"
                                          ToolTip="Repeat" Click="RepeatButton_Click">
                                <Viewbox Width="18" Height="18">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"
                                              Data="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
                                    </Canvas>
                                </Viewbox>
                            </ToggleButton>
                            <ToggleButton x:Name="PlaylistToggle" Style="{StaticResource ToggleButtonStyle}"
                                          ToolTip="Playlist" Margin="4,0,0,0" Click="PlaylistToggle_Click">
                                <Viewbox Width="18" Height="18">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"
                                              Data="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                                    </Canvas>
                                </Viewbox>
                            </ToggleButton>
                            <ToggleButton x:Name="LyricsToggle" Style="{StaticResource ToggleButtonStyle}"
                                          ToolTip="Lyrics" Margin="4,0,0,0" Click="LyricsToggle_Click">
                                <Viewbox Width="18" Height="18">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"
                                              Data="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
                                    </Canvas>
                                </Viewbox>
                            </ToggleButton>
                        </StackPanel>
                    </Grid>
                </Grid>

                <!-- Playlist Panel -->
                <Border x:Name="PlaylistPanel" Grid.Column="1" Background="#252525"
                        BorderBrush="#404040" BorderThickness="1,0,0,0" Visibility="Collapsed">
                    <Grid Margin="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Playlist Header: title + History / Library icon buttons -->
                        <Grid Margin="8,4,8,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Playlist" FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button x:Name="HistoryButton" Style="{StaticResource ControlButtonStyle}"
                                        Click="HistoryButton_Click" ToolTip="History" Width="26" Height="26">
                                    <Viewbox Width="14" Height="14">
                                        <Canvas Width="24" Height="24">
                                            <Path Fill="{StaticResource TextSecondaryBrush}"
                                                  Data="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z"/>
                                        </Canvas>
                                    </Viewbox>
                                </Button>
                                <Button x:Name="LibraryButton" Style="{StaticResource ControlButtonStyle}"
                                        Click="LibraryButton_Click" ToolTip="Library" Width="26" Height="26" Margin="2,0,0,0">
                                    <Viewbox Width="14" Height="14">
                                        <Canvas Width="24" Height="24">
                                            <Path Fill="{StaticResource TextSecondaryBrush}"
                                                  Data="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"/>
                                        </Canvas>
                                    </Viewbox>
                                </Button>
                            </StackPanel>
                        </Grid>

                        <!-- Playlist Buttons -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="8,0,8,8">
                            <Button x:Name="AddFilesButton" Width="32" Height="28"
                                    Style="{StaticResource ControlButtonStyle}" Click="AddFilesButton_Click"
                                    ToolTip="Add files">
                                <Viewbox Width="14" Height="14">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="{StaticResource TextPrimaryBrush}" Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                    </Canvas>
                                </Viewbox>
                            </Button>
                            <Button x:Name="ClearPlaylistButton" Content="Clear" Height="28" Padding="8,0"
                                    Style="{StaticResource ControlButtonStyle}" Click="ClearPlaylistButton_Click"
                                    ToolTip="Clear playlist" FontSize="11" Margin="4,0,0,0"/>
                            <Button x:Name="SavePlaylistButton" Content="Save" Height="28" Padding="8,0"
                                    Style="{StaticResource ControlButtonStyle}" Click="SavePlaylistButton_Click"
                                    ToolTip="Save playlist to file" FontSize="11" Margin="4,0,0,0"/>
                            <Button x:Name="LoadPlaylistButton" Content="Load" Height="28" Padding="8,0"
                                    Style="{StaticResource ControlButtonStyle}" Click="LoadPlaylistButton_Click"
                                    ToolTip="Load playlist from file" FontSize="11" Margin="4,0,0,0"/>
                        </StackPanel>

                        <ListBox x:Name="PlaylistBox" Grid.Row="2"
                                 Style="{StaticResource DarkListBoxStyle}"
                                 ItemContainerStyle="{StaticResource PlaylistItemStyle}"
                                 MouseDoubleClick="PlaylistBox_MouseDoubleClick"
                                 AllowDrop="True" Drop="PlaylistBox_Drop"
                                 DragEnter="PlaylistBox_DragEnter">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid x:Name="ItemGrid">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="{Binding DisplayTitle}" FontSize="12"
                                                       Foreground="{StaticResource TextPrimaryBrush}"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding DisplayArtist}" FontSize="10"
                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="1" Text="{Binding DurationText}" FontSize="10"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   VerticalAlignment="Center" Margin="8,0,0,0"/>
                                        <!-- 즐겨찾기 별 버튼 -->
                                        <ToggleButton Grid.Column="2"
                                                      IsChecked="{Binding IsFavorite, Mode=OneWay}"
                                                      Click="FavoriteButton_Click"
                                                      Width="22" Height="22" Margin="4,0,0,0"
                                                      VerticalAlignment="Center" Cursor="Hand"
                                                      ToolTip="즐겨찾기">
                                            <ToggleButton.Style>
                                                <Style TargetType="ToggleButton">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="BorderThickness" Value="0"/>
                                                    <Setter Property="Foreground" Value="#404040"/>
                                                    <Setter Property="Content" Value="★"/>
                                                    <Setter Property="FontSize" Value="14"/>
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="ToggleButton">
                                                                <Border Background="Transparent">
                                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                </Border>
                                                                <ControlTemplate.Triggers>
                                                                    <Trigger Property="IsChecked" Value="True">
                                                                        <Setter Property="Foreground" Value="#FF6B35"/>
                                                                    </Trigger>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Foreground" Value="#FF8555"/>
                                                                    </Trigger>
                                                                </ControlTemplate.Triggers>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </ToggleButton.Style>
                                        </ToggleButton>
                                        <Button x:Name="RemoveButton" Grid.Column="3" Content="×" Width="22" Height="22"
                                                FontSize="16" FontWeight="Bold" Margin="4,0,0,0"
                                                VerticalAlignment="Center" Cursor="Hand"
                                                Click="RemoveTrackButton_Click"
                                                ToolTip="Remove from playlist">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Background" Value="#404040"/>
                                                    <Setter Property="Foreground" Value="#AAAAAA"/>
                                                    <Setter Property="BorderThickness" Value="0"/>
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border x:Name="border" Background="{TemplateBinding Background}"
                                                                        CornerRadius="11">
                                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-4,0,0"/>
                                                                </Border>
                                                                <ControlTemplate.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter TargetName="border" Property="Background" Value="#E81123"/>
                                                                        <Setter Property="Foreground" Value="White"/>
                                                                    </Trigger>
                                                                </ControlTemplate.Triggers>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
