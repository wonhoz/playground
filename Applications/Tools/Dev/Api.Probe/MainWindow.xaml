<Window x:Class="ApiProbe.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Api.Probe" Height="700" Width="1100"
        MinHeight="560" MinWidth="860"
        Background="{StaticResource Bg0Brush}"
        Foreground="{StaticResource FgBrush}"
        WindowStartupLocation="CenterScreen"
        Icon="Resources/app.ico">
  <Grid>
    <Grid.ColumnDefinitions>
      <!-- 사이드바 -->
      <ColumnDefinition Width="220" MinWidth="160" MaxWidth="320"/>
      <ColumnDefinition Width="4"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>

    <!-- ── 사이드바 ──────────────────────────────────────────── -->
    <Border Grid.Column="0" Background="{StaticResource Bg1Brush}">
      <DockPanel LastChildFill="True">
        <!-- 헤더 -->
        <Border DockPanel.Dock="Top" Padding="12,14" BorderThickness="0,0,0,1"
                BorderBrush="{StaticResource BorderBrush2}">
          <StackPanel>
            <TextBlock Text="Api.Probe" FontSize="16" FontWeight="Bold"
                       Foreground="{StaticResource AccentBrush}"/>
            <TextBlock Text="오프라인 API 테스터" FontSize="11"
                       Foreground="{StaticResource FgDimBrush}" Margin="0,2,0,0"/>
          </StackPanel>
        </Border>

        <!-- 환경변수 셀렉터 -->
        <Border DockPanel.Dock="Top" Padding="10,8" BorderThickness="0,0,0,1"
                BorderBrush="{StaticResource BorderBrush2}">
          <StackPanel>
            <TextBlock Text="환경" FontSize="11" Foreground="{StaticResource FgDimBrush}" Margin="0,0,0,4"/>
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>
              <ComboBox x:Name="CmbEnv" Grid.Column="0" Margin="0,0,6,0"
                        SelectionChanged="CmbEnv_Changed"/>
              <Button Grid.Column="1" Content="편집"
                      Padding="8,5" FontSize="12" Click="EditEnv"/>
            </Grid>
          </StackPanel>
        </Border>

        <!-- 컬렉션 관리 버튼 -->
        <Border DockPanel.Dock="Top" Padding="10,8" BorderThickness="0,0,0,1"
                BorderBrush="{StaticResource BorderBrush2}">
          <WrapPanel>
            <Button Content="+ 컬렉션" Click="AddCollection" Padding="8,4"
                    FontSize="12" Margin="0,0,4,0"/>
            <Button Content="+ 요청" Click="AddRequest" Padding="8,4"
                    FontSize="12"/>
          </WrapPanel>
        </Border>

        <!-- 컬렉션/요청 트리 -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel x:Name="CollectionPanel"/>
        </ScrollViewer>
      </DockPanel>
    </Border>

    <!-- ── 스플리터 ────────────────────────────────────────────── -->
    <GridSplitter Grid.Column="1" Width="4"
                  Background="{StaticResource BorderBrush2}"
                  HorizontalAlignment="Stretch"/>

    <!-- ── 메인 영역 ─────────────────────────────────────────── -->
    <Grid Grid.Column="2" Margin="0">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <!-- 요청 URL 바 -->
        <RowDefinition Height="Auto"/>
        <!-- 탭 헤더 -->
        <RowDefinition Height="220" MinHeight="120"/>
        <!-- 요청 세부 -->
        <RowDefinition Height="6"/>
        <!-- 스플리터 -->
        <RowDefinition Height="*" MinHeight="120"/>
        <!-- 응답 -->
      </Grid.RowDefinitions>

      <!-- URL 바 -->
      <Border Grid.Row="0" Background="{StaticResource Bg1Brush}"
              Padding="12,10" BorderThickness="0,0,0,1"
              BorderBrush="{StaticResource BorderBrush2}">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="110"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <ComboBox x:Name="CmbMethod" Grid.Column="0" Margin="0,0,8,0">
            <ComboBoxItem Content="GET"    IsSelected="True"/>
            <ComboBoxItem Content="POST"/>
            <ComboBoxItem Content="PUT"/>
            <ComboBoxItem Content="PATCH"/>
            <ComboBoxItem Content="DELETE"/>
            <ComboBoxItem Content="HEAD"/>
            <ComboBoxItem Content="OPTIONS"/>
          </ComboBox>

          <TextBox x:Name="TxtUrl" Grid.Column="1" Margin="0,0,8,0"
                   FontFamily="Consolas" FontSize="13"
                   Text="https://httpbin.org/get"
                   KeyDown="TxtUrl_KeyDown"/>

          <Button Grid.Column="2" Content="전송" Width="72"
                  Style="{StaticResource AccentButton}"
                  Click="SendRequest" Margin="0,0,8,0"/>

          <Button Grid.Column="3" Content="cURL 복사"
                  Click="CopyCurl" Padding="8,6"/>
        </Grid>
      </Border>

      <!-- 요청 탭 -->
      <TabControl x:Name="ReqTabs" Grid.Row="2"
                  Background="{StaticResource Bg1Brush}"
                  Padding="0">
        <TabControl.Resources>
          <Style TargetType="TabPanel">
            <Setter Property="Background" Value="{StaticResource Bg1Brush}"/>
          </Style>
        </TabControl.Resources>

        <!-- 헤더 탭 -->
        <TabItem Header="헤더">
          <Grid Background="{StaticResource Bg1Brush}">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Border Grid.Row="0" Padding="10,6" BorderThickness="0,0,0,1"
                    BorderBrush="{StaticResource BorderBrush2}">
              <Button Content="+ 헤더 추가" Click="AddHeader"
                      Padding="8,4" FontSize="12" HorizontalAlignment="Left"/>
            </Border>
            <DataGrid x:Name="HeaderGrid" Grid.Row="1"
                      ItemsSource="{Binding Headers}"
                      Margin="0" CanUserAddRows="False">
              <DataGrid.Columns>
                <DataGridCheckBoxColumn  Header="✓" Binding="{Binding Enabled}" Width="36"/>
                <DataGridTextColumn      Header="키" Binding="{Binding Key}"   Width="180"/>
                <DataGridTextColumn      Header="값" Binding="{Binding Value}" Width="*"/>
              </DataGrid.Columns>
            </DataGrid>
          </Grid>
        </TabItem>

        <!-- 바디 탭 -->
        <TabItem Header="바디">
          <Grid Background="{StaticResource Bg1Brush}">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Border Grid.Row="0" Padding="10,6" BorderThickness="0,0,0,1"
                    BorderBrush="{StaticResource BorderBrush2}">
              <StackPanel Orientation="Horizontal">
                <TextBlock Text="Content-Type:" Foreground="{StaticResource FgDimBrush}"
                           VerticalAlignment="Center" Margin="0,0,8,0" FontSize="12"/>
                <ComboBox x:Name="CmbContentType" Width="200" FontSize="12">
                  <ComboBoxItem Content="application/json" IsSelected="True"/>
                  <ComboBoxItem Content="application/x-www-form-urlencoded"/>
                  <ComboBoxItem Content="text/plain"/>
                  <ComboBoxItem Content="text/xml"/>
                </ComboBox>
              </StackPanel>
            </Border>
            <TextBox x:Name="TxtBody" Grid.Row="1"
                     AcceptsReturn="True" AcceptsTab="True"
                     TextWrapping="NoWrap"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"
                     FontFamily="Consolas" FontSize="13"
                     Background="{StaticResource Bg1Brush}"
                     Padding="12"
                     Text=""/>
          </Grid>
        </TabItem>

        <!-- 요청 이름 탭 -->
        <TabItem Header="정보">
          <StackPanel Background="{StaticResource Bg1Brush}" Margin="12">
            <TextBlock Text="요청 이름" Foreground="{StaticResource FgDimBrush}"
                       FontSize="12" Margin="0,0,0,4"/>
            <TextBox x:Name="TxtReqName" FontFamily="Segoe UI" FontSize="13"
                     TextChanged="ReqName_Changed"/>
          </StackPanel>
        </TabItem>
      </TabControl>

      <!-- 가로 스플리터 -->
      <GridSplitter Grid.Row="3" Height="6"
                    Background="{StaticResource BorderBrush2}"
                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>

      <!-- ── 응답 패널 ─────────────────────────────────────────── -->
      <Grid Grid.Row="4" Background="{StaticResource Bg0Brush}">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 응답 상태 바 -->
        <Border Grid.Row="0" Background="{StaticResource Bg1Brush}"
                Padding="12,8" BorderThickness="0,0,0,1"
                BorderBrush="{StaticResource BorderBrush2}">
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="응답" FontSize="13" FontWeight="SemiBold"
                       Foreground="{StaticResource FgBrush}" Margin="0,0,16,0"/>
            <Border x:Name="StatusBadge" CornerRadius="4" Padding="8,2" Margin="0,0,12,0"
                    Background="{StaticResource Bg3Brush}" Visibility="Collapsed">
              <TextBlock x:Name="TxtStatus" FontSize="12" FontWeight="Bold"/>
            </Border>
            <TextBlock x:Name="TxtElapsed" FontSize="12"
                       Foreground="{StaticResource FgDimBrush}"
                       VerticalAlignment="Center"/>
            <Border Width="1" Background="{StaticResource BorderBrush2}" Margin="12,2"/>
            <Button Content="복사" Click="CopyResponse"
                    Padding="8,4" FontSize="12"/>
          </StackPanel>
        </Border>

        <!-- 응답 탭 -->
        <TabControl x:Name="RespTabs" Grid.Row="1"
                    Background="{StaticResource Bg0Brush}" Padding="0">
          <TabControl.Resources>
            <Style TargetType="TabPanel">
              <Setter Property="Background" Value="{StaticResource Bg1Brush}"/>
            </Style>
          </TabControl.Resources>

          <TabItem Header="바디">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Background="{StaticResource Bg0Brush}">
              <TextBox x:Name="TxtRespBody"
                       IsReadOnly="True" TextWrapping="NoWrap"
                       AcceptsReturn="True"
                       FontFamily="Consolas" FontSize="12"
                       Background="Transparent"
                       BorderThickness="0"
                       Padding="12"
                       Text="← 요청을 전송하면 응답이 여기에 표시됩니다."/>
            </ScrollViewer>
          </TabItem>

          <TabItem Header="헤더">
            <ScrollViewer Background="{StaticResource Bg0Brush}">
              <TextBox x:Name="TxtRespHeaders"
                       IsReadOnly="True" AcceptsReturn="True"
                       FontFamily="Consolas" FontSize="12"
                       Background="Transparent"
                       BorderThickness="0"
                       Padding="12"/>
            </ScrollViewer>
          </TabItem>
        </TabControl>
      </Grid>
    </Grid>
  </Grid>
</Window>
