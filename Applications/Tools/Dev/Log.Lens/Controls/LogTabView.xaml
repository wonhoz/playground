<UserControl x:Class="LogLens.Controls.LogTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:LogLens.Controls"
             Background="#0D0D14">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ── 필터 바 ── -->
        <Border Grid.Row="0" Background="#131320"
                BorderBrush="#2A2A3A" BorderThickness="0,0,0,1"
                Padding="8,6">
            <WrapPanel>
                <TextBox x:Name="TxtFilter" Width="200" Height="27" Margin="0,0,8,0"
                         VerticalContentAlignment="Center"
                         TextChanged="TxtFilter_TextChanged"
                         ToolTip="키워드 또는 정규식 입력"/>

                <CheckBox x:Name="ChkRegex"   Content="정규식"   Margin="0,0,8,0"
                          Checked="FilterOptionChanged" Unchecked="FilterOptionChanged"/>
                <CheckBox x:Name="ChkCase"    Content="대소문자" Margin="0,0,8,0"
                          Checked="FilterOptionChanged" Unchecked="FilterOptionChanged"/>
                <CheckBox x:Name="ChkExclude" Content="제외"     Margin="0,0,10,0"
                          Checked="FilterOptionChanged" Unchecked="FilterOptionChanged"/>

                <!-- 구분선 -->
                <Border Width="1" Margin="0,3,10,3" Background="#2A2A3A" VerticalAlignment="Stretch"/>

                <!-- 레벨 필터 -->
                <ComboBox x:Name="CmbLevel" Width="108" Height="27" Margin="0,0,10,0"
                          SelectionChanged="CmbLevel_SelectionChanged"
                          ToolTip="최소 로그 레벨 필터">
                    <ComboBoxItem Content="모든 레벨" IsSelected="True"/>
                    <ComboBoxItem Content="TRACE+"/>
                    <ComboBoxItem Content="DEBUG+"/>
                    <ComboBoxItem Content="INFO+"/>
                    <ComboBoxItem Content="WARN+"/>
                    <ComboBoxItem Content="ERROR+"/>
                    <ComboBoxItem Content="FATAL"/>
                </ComboBox>

                <!-- 구분선 -->
                <Border Width="1" Margin="0,3,10,3" Background="#2A2A3A" VerticalAlignment="Stretch"/>

                <CheckBox x:Name="ChkAutoScroll" Content="자동 스크롤" IsChecked="True"
                          Margin="0,0,10,0"/>

                <Button x:Name="BtnClear" Content="지우기" Height="27"
                        Style="{StaticResource SecondaryBtn}"
                        Click="BtnClear_Click"
                        ToolTip="현재 탭 로그 지우기"/>
            </WrapPanel>
        </Border>

        <!-- ── 로그 목록 (VirtualizingStackPanel) ── -->
        <ListBox Grid.Row="1" x:Name="LstLog"
                 VirtualizingStackPanel.IsVirtualizing="True"
                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                 ScrollViewer.CanContentScroll="True"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                 SelectionMode="Extended"
                 FontFamily="Consolas" FontSize="12">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="52"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 줄 번호 -->
                        <TextBlock Text="{Binding NumberStr}"
                                   Foreground="#363646"
                                   FontFamily="Consolas" FontSize="11"
                                   HorizontalAlignment="Right"
                                   Padding="0,2,8,2"
                                   VerticalAlignment="Top"/>

                        <!-- 로그 내용 (하이라이트 지원) -->
                        <local:HighlightTextBlock Grid.Column="1"
                            Text="{Binding DisplayText}"
                            Foreground="{Binding LevelBrush}"
                            FontFamily="Consolas" FontSize="12"
                            Padding="0,2,4,2"
                            HighlightPattern="{Binding HighlightPattern,
                                RelativeSource={RelativeSource AncestorType={x:Type local:LogTabView}}}"
                            UseRegex="{Binding UseRegexHL,
                                RelativeSource={RelativeSource AncestorType={x:Type local:LogTabView}}}"
                            CaseSensitive="{Binding CaseSensitiveHL,
                                RelativeSource={RelativeSource AncestorType={x:Type local:LogTabView}}}"/>
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!-- ── 상태 바 ── -->
        <Border Grid.Row="2" Background="#131320"
                BorderBrush="#2A2A3A" BorderThickness="0,1,0,0"
                Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="TxtFilePath"
                               Foreground="#555565" FontSize="11" VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"/>
                    <TextBlock Text=" | " Foreground="#333343" FontSize="11" VerticalAlignment="Center"/>
                    <TextBlock x:Name="TxtLineCount"
                               Foreground="#888898" FontSize="11" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Ellipse x:Name="EllStatus" Width="7" Height="7"
                             Fill="#00C8FF" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock x:Name="TxtWatchStatus"
                               Text="감시 중" Foreground="#00C8FF" FontSize="11" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
