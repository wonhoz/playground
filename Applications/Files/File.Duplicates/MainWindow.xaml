<Window x:Class="FileDuplicates.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="File.Duplicates" Height="700" Width="1060"
        MinHeight="500" MinWidth="760"
        Background="#1E1E1E" Foreground="#E0E0E0"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <!-- Brushes -->
        <SolidColorBrush x:Key="BgBrush"        Color="#1E1E1E"/>
        <SolidColorBrush x:Key="PanelBrush"     Color="#252526"/>
        <SolidColorBrush x:Key="BorderBrush"     Color="#3A3A3A"/>
        <SolidColorBrush x:Key="AccentBrush"     Color="#0097C8"/>
        <SolidColorBrush x:Key="AccentHoverBrush" Color="#00B0E8"/>
        <SolidColorBrush x:Key="TextPrimary"     Color="#E0E0E0"/>
        <SolidColorBrush x:Key="TextSecondary"   Color="#888888"/>
        <SolidColorBrush x:Key="HashBadgeBrush"  Color="#1C6EA4"/>
        <SolidColorBrush x:Key="SimiBadgeBrush"  Color="#6A3FA0"/>
        <SolidColorBrush x:Key="DangerBrush"     Color="#C0392B"/>
        <SolidColorBrush x:Key="DangerHoverBrush" Color="#E74C3C"/>
        <SolidColorBrush x:Key="KeepBrush"       Color="#27AE60"/>

        <!-- Button base style -->
        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Background"   Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground"   Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding"      Value="12,6"/>
            <Setter Property="FontSize"     Value="12"/>
            <Setter Property="Cursor"       Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="{StaticResource DangerBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource DangerHoverBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="GhostButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#333333"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#444444"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ScrollBar: App.xaml 전역 스타일 사용 (ControlTemplate 포함) -->

        <!-- CheckBox -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground"  Value="{StaticResource TextPrimary}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="CheckBorder" Width="16" Height="16" CornerRadius="3"
                                    Background="#2A2A2A" BorderBrush="#555555" BorderThickness="1"
                                    VerticalAlignment="Center">
                                <TextBlock x:Name="CheckMark" Text="✓" FontSize="11" FontWeight="Bold"
                                           Foreground="{StaticResource AccentBrush}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center"
                                           Visibility="Collapsed"/>
                            </Border>
                            <ContentPresenter Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="CheckBorder" Property="Background" Value="#0A3A50"/>
                                <Setter TargetName="CheckBorder" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CheckBorder" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Slider -->
        <Style TargetType="Slider">
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
        </Style>

        <!-- ListBox (folders) -->
        <Style x:Key="FolderListBox" TargetType="ListBox">
            <Setter Property="Background"       Value="#1A1A1A"/>
            <Setter Property="BorderBrush"      Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness"  Value="1"/>
            <Setter Property="Foreground"       Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize"         Value="11"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        </Style>
        <Style TargetType="ListBoxItem">
            <Setter Property="Foreground"   Value="{StaticResource TextPrimary}"/>
            <Setter Property="Padding"      Value="6,4"/>
            <Setter Property="FontSize"     Value="11"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#2A4A6A"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ═══ 왼쪽 패널 ═══ -->
        <Border Grid.Column="0" Background="{StaticResource PanelBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
            <Grid Margin="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 헤더 -->
                <StackPanel Grid.Row="0" Margin="0,0,0,12">
                    <TextBlock Text="File.Duplicates" FontSize="16" FontWeight="Bold"
                               Foreground="{StaticResource AccentBrush}"/>
                    <TextBlock Text="중복 파일 탐지 및 정리" FontSize="11"
                               Foreground="{StaticResource TextSecondary}" Margin="0,2,0,0"/>
                </StackPanel>

                <!-- 폴더 추가/제거 버튼 -->
                <Grid Grid.Row="1" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="6"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0" Content="+ 폴더 추가" Style="{StaticResource ActionButton}"
                            Click="AddFolder_Click"/>
                    <Button Grid.Column="2" Content="제거" Style="{StaticResource GhostButton}"
                            Click="RemoveFolder_Click" x:Name="RemoveFolderBtn"/>
                </Grid>

                <!-- 폴더 목록 -->
                <ListBox Grid.Row="2" x:Name="FolderListBox" Style="{StaticResource FolderListBox}"
                         Margin="0,0,0,12" SelectionChanged="FolderList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" ToolTip="{Binding}"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- 옵션 -->
                <StackPanel Grid.Row="3" Margin="0,0,0,12">
                    <TextBlock Text="옵션" FontSize="11" FontWeight="SemiBold"
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <CheckBox x:Name="SubfoldersCheck" Content="하위 폴더 포함" IsChecked="True" Margin="0,3"/>
                    <CheckBox x:Name="HashScanCheck"   Content="SHA256 해시 스캔" IsChecked="True" Margin="0,3"/>
                    <CheckBox x:Name="ImageScanCheck"  Content="유사 이미지 스캔" IsChecked="True" Margin="0,3"
                              Checked="ImageScan_Changed" Unchecked="ImageScan_Changed"/>

                    <!-- 유사도 임계값 -->
                    <StackPanel x:Name="ThresholdPanel" Margin="0,8,0,0">
                        <Grid>
                            <TextBlock Text="유사도 임계값" FontSize="11"
                                       Foreground="{StaticResource TextSecondary}"/>
                            <TextBlock x:Name="ThresholdLabel" HorizontalAlignment="Right"
                                       FontSize="11" Foreground="{StaticResource AccentBrush}"/>
                        </Grid>
                        <Slider x:Name="ThresholdSlider" Minimum="1" Maximum="20" Value="10"
                                TickFrequency="1" IsSnapToTickEnabled="True"
                                ValueChanged="Threshold_Changed" Margin="0,4,0,0"/>
                        <TextBlock FontSize="10" Foreground="{StaticResource TextSecondary}"
                                   Text="낮을수록 엄격 (권장: 8~12)" Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- 스캔 버튼 -->
                <Button Grid.Row="4" x:Name="ScanBtn" Content="스캔 시작"
                        Style="{StaticResource ActionButton}" FontSize="13" FontWeight="SemiBold"
                        Padding="12,10" Click="Scan_Click"/>
            </Grid>
        </Border>

        <!-- ═══ 오른쪽 패널 ═══ -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 상태 바 + 액션 버튼 -->
            <Border Grid.Row="0" Background="{StaticResource PanelBrush}"
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="12,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                        <TextBlock x:Name="StatusText" Text="폴더를 추가하고 스캔을 시작하세요."
                                   FontSize="12" Foreground="{StaticResource TextSecondary}"/>
                        <TextBlock x:Name="ProgressText" FontSize="11"
                                   Foreground="{StaticResource AccentBrush}" Visibility="Collapsed"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button x:Name="AutoSelectBtn" Content="중복 자동 선택"
                                Style="{StaticResource GhostButton}" Margin="0,0,6,0"
                                Click="AutoSelect_Click" IsEnabled="False"/>
                        <Button x:Name="SelectNoneBtn" Content="선택 해제"
                                Style="{StaticResource GhostButton}" Margin="0,0,6,0"
                                Click="SelectNone_Click" IsEnabled="False"/>
                        <Button x:Name="MoveBtn" Content="이동..."
                                Style="{StaticResource GhostButton}" Margin="0,0,6,0"
                                Click="Move_Click" IsEnabled="False"/>
                        <Button x:Name="DeleteBtn" Content="휴지통으로"
                                Style="{StaticResource DangerButton}"
                                Click="Delete_Click" IsEnabled="False"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 결과 목록 -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled" Background="{StaticResource BgBrush}">
                <StackPanel x:Name="ResultsPanel" Margin="12">

                    <!-- 빈 상태 안내 -->
                    <TextBlock x:Name="EmptyHint"
                               Text="스캔 결과가 여기에 표시됩니다."
                               FontSize="13" Foreground="{StaticResource TextSecondary}"
                               HorizontalAlignment="Center" Margin="0,60,0,0"/>

                    <!-- 중복 그룹 목록 (코드에서 동적 생성) -->
                    <ItemsControl x:Name="GroupsControl">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- 그룹 카드 -->
                                <Border Margin="0,0,0,10" Background="{StaticResource PanelBrush}"
                                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                        CornerRadius="8">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black" Opacity="0.3" BlurRadius="8" ShadowDepth="2"/>
                                    </Border.Effect>
                                    <StackPanel>
                                        <!-- 그룹 헤더 -->
                                        <Border Padding="10,8" BorderBrush="{StaticResource BorderBrush}"
                                                BorderThickness="0,0,0,1">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <!-- 배지 -->
                                                <Border Grid.Column="0" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Type}" Value="Hash">
                                                                    <Setter Property="Background" Value="{StaticResource HashBadgeBrush}"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Type}" Value="Similar">
                                                                    <Setter Property="Background" Value="{StaticResource SimiBadgeBrush}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <TextBlock Text="{Binding TypeBadge}" FontSize="10"
                                                               FontWeight="SemiBold" Foreground="White"/>
                                                </Border>
                                                <TextBlock Grid.Column="1" Text="{Binding Summary}"
                                                           FontSize="12" Foreground="{StaticResource TextPrimary}"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>

                                        <!-- 파일 목록 -->
                                        <ItemsControl ItemsSource="{Binding Files}" Margin="10,6,10,8">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="0,3">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <CheckBox Grid.Column="0"
                                                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                  Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding Path}"
                                                                   FontSize="11" Foreground="{StaticResource TextPrimary}"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   ToolTip="{Binding Path}" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="2" Text="{Binding SizeText}"
                                                                   FontSize="11" Foreground="{StaticResource TextSecondary}"
                                                                   Margin="12,0,0,0" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="3"
                                                                   Text="{Binding LastModified, StringFormat={}{0:yyyy-MM-dd}}"
                                                                   FontSize="11" Foreground="{StaticResource TextSecondary}"
                                                                   Margin="12,0,0,0" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>

            <!-- 하단 진행 바 -->
            <Border Grid.Row="2" Background="{StaticResource PanelBrush}"
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0"
                    Padding="12,6" x:Name="ProgressBar" Visibility="Collapsed">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <ProgressBar x:Name="ScanProgress" Grid.Column="0" Height="4"
                                 Background="#333333" Foreground="{StaticResource AccentBrush}"
                                 BorderThickness="0" VerticalAlignment="Center">
                        <ProgressBar.Clip>
                            <RectangleGeometry RadiusX="2" RadiusY="2"
                                               Rect="0,0,10000,4"/>
                        </ProgressBar.Clip>
                    </ProgressBar>
                    <Button Grid.Column="1" Content="취소" Style="{StaticResource GhostButton}"
                            Margin="10,0,0,0" Padding="10,4" Click="Cancel_Click"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
